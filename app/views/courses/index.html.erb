<h2 class="title-divider"><span>StrategicHR <span class="de-em">Online Training Courses</span></span> <small></small></h2>

<div class="col-md-8">
  <% if can? :create, Course %>
    <%= link_to "New Course", new_course_path, class: 'btn btn-primary btn-mini' %>
  <% end %>
</div>
<br><br>
<% if !current_user %>
  <div class="col-md-8">
    <% @courses.each do |course| %>
      <h4 class="media-heading" %>
        <%= link_to course.name, course_path(course) %>
      </h4>
      <p>
        <%= markdown course.description.split[0..60].join(' ')+"...[Click here to learn more about this course](#{course_path(course)})." %>
      </p>
      <br>
    <% end %>
  </div>
<% else %>
  <div class="table-responsive">
    <table class="table table-striped table-bordered table-condensed">
      <tr>
        <th>Course Name</th>
        <% if can? :take, Course %>
          <th>Status</th>
          <th>Next Step</th>
        <% else %>
          <th>Description</th>
        <% end %>
      </tr>
      <% @courses.each do |course| %>
        <tr>
          <td><%= link_to course.name, course_path(course) %></td>
          <% if can? :take, Course %>
            <td><%= course.my_status(current_user.id) %></td>
            <% if can? :purchase_certificate, course %>
              <td><%= link_to "Purchase Certificate", new_charge_path(course_id: course.id), class: 'btn btn-primary btn-mini' %></td>
            <% elsif can? :view_certificate, course %>
              <td><%= link_to "View Certificate", certificate_path(Certificate.where(user_id: current_user.id, course_id: course.id).first, format: "pdf"), class: 'btn btn-primary btn-mini' %></td>
            <% else %>
               <td><%= link_to "View Course Info", course_path(course), class: 'btn btn-primary btn-mini' %></td>
            <% end %>
          <% else %>
            <td><%= markdown course.description.split[0..60].join(' ')+"...[Click here to learn more about this course](#{course_path(course)})." %></td>
          <% end %>
        </tr>
      <% end %>
    </table>
  </div>
<% end %>

