<h1><%= @course.name %></h1>

<% if can? :update, @course %>
  <%= link_to "Edit Course", edit_course_path(@course), class: 'btn btn-primary btn-mini' %>
<% end %>
<% if can? :destroy, @course %>
  <%= link_to "Delete Course", @course, method: :delete, class: 'btn btn-primary btn-mini btn-danger', data: { confirm: 'Are you sure you want to delete this course?' } %> 
<% end %>
<% if can? :create, Course %>
  <%= link_to "New Course", new_course_path, class: 'btn btn-primary btn-mini' %>
<% end %>
<% if can? :take, Course %>
  <% if @course_status_rec.purchased_certificate %>
    <%= link_to "View Certificate", certificate_path(Certificate.where(user_id: current_user.id, course_id: @course.id), format: "pdf"), class: 'btn btn-primary btn-mini' %>
  <% end %>
<% end %>

<div class="span8">
  <p class="lead"><%= markdown @course.description %></p>
</div>
<br>
<% if can? :take, @course %>
  <h4>Course Videos & Quizzes</h4>
  <table>
    <tr>
      <th>Video</th>
      <th>Quiz</th>
      <th>Quiz Status</th>
    </tr>
    <% @sections.each do |section| %>
      <tr>
        <td><%= link_to Video.find(section.video_id).name, video_path(Video.find(section.video_id)) %></td>
        <td><%= link_to Quiz.find(section.quiz_id).name, quiz_path(Quiz.find(section.quiz_id)) %></td>

        <% if !@section_statuses.empty? %>
          <% if @section_statuses.where(section_id: section.id).first.completed_quiz == true %>
            <td>PASSED</td>
          <% else %>
            <td>NOT PASSED</td>
          <% end %>
        <% else %>
          <td> NOT PASSED</td>
        <% end %>

      </tr>
    <% end %>
<% end %>

<p>
  <% if !current_user %>
    <h3>Yes, I want to enroll in this class and earn CEU credits!</h3>
    <%= link_to "Sign-in", login_path, class: 'btn btn-primary btn-large' %> or 
    <%= link_to "Register", new_user_path, class: 'btn btn-primary btn-large' %> today!
  <% else %>
  <% end %>
</p>
